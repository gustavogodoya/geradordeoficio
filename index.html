<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Of√≠cios - DRCI/PC-MT</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(30, 30, 50, 0.9);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            padding: 30px;
            backdrop-filter: blur(10px);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #4a5568;
            padding-bottom: 20px;
        }
        .title {
            font-size: 2.2rem;
            font-weight: bold;
            color: #90cdf4;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        .description { font-size: 0.9rem; color: #718096; margin-bottom: 10px; }
        .credits { font-size: 0.8rem; color: #4a5568; font-style: italic; }
        .form-group { margin-bottom: 20px; }
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #cbd5e0;
            font-size: 0.95rem;
        }
        .form-control, .select-control {
            width: 100%;
            padding: 12px 15px;
            background: rgba(45, 55, 72, 0.8);
            border: 2px solid #4a5568;
            border-radius: 8px;
            color: #e2e8f0;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }
        .form-control:focus, .select-control:focus {
            outline: none;
            border-color: #90cdf4;
            box-shadow: 0 0 0 3px rgba(144, 205, 244, 0.1);
        }
        .config-section {
            background: rgba(45, 55, 72, 0.5);
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
            border: 1px solid #4a5568;
            display: none;
        }
        .config-section.show { display: block; }
        .suggestions-container { margin-top: 10px; }
        .suggestions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        .suggestion-btn {
            background: linear-gradient(45deg, #4299e1, #3182ce);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }
        .suggestion-btn:hover {
            background: linear-gradient(45deg, #3182ce, #2c5282);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .period-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 10px;
        }
        .email-prazo-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            align-items: end;
        }
        .meta-fields-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 10px;
        }
        .btn {
            background: linear-gradient(45deg, #48bb78, #38a169);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
        }
        .btn:hover {
            background: linear-gradient(45deg, #38a169, #2f855a);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }
        .btn-secondary { background: linear-gradient(45deg, #e53e3e, #c53030); }
        .btn-secondary:hover { background: linear-gradient(45deg, #c53030, #9c2626); }
        .btn-info { background: linear-gradient(45deg, #4299e1, #3182ce); }
        .btn-info:hover { background: linear-gradient(45deg, #3182ce, #2c5282); }
        .resultado-section {
            background: rgba(45, 55, 72, 0.5);
            border-radius: 10px;
            padding: 25px;
            margin-top: 20px;
            border: 1px solid #4a5568;
        }
        .resultado-textarea {
            width: 100%;
            height: 400px;
            padding: 20px;
            background: #f7fafc;
            color: #2d3748;
            border: 2px solid #cbd5e0;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.95rem;
            line-height: 1.6;
            resize: vertical;
        }
        .resultado-textarea:focus {
            outline: none;
            border-color: #4299e1;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
        }
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .hidden { display: none !important; }
        .warning-text {
            color: #f6ad55;
            font-size: 0.85rem;
            margin-top: 5px;
            font-style: italic;
        }
        .help-text { color: #a0aec0; font-size: 0.8rem; margin-top: 5px; }
        .ip-textarea {
            width: 100%;
            height: 120px;
            padding: 12px;
            background: rgba(45, 55, 72, 0.8);
            border: 2px solid #4a5568;
            border-radius: 8px;
            color: #e2e8f0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            resize: vertical;
        }
        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(45, 55, 72, 0.6);
            border-radius: 8px;
            border: 1px solid #4a5568;
        }
        .checkbox-container input[type="checkbox"] {
            transform: scale(1.5);
            margin-right: 5px;
            cursor: pointer;
        }
        @media (max-width: 768px) {
            .container { padding: 20px; }
            .period-group, .email-prazo-group, .meta-fields-grid { grid-template-columns: 1fr; }
            .btn-group { flex-direction: column; }
            .btn { margin-right: 0; margin-bottom: 10px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">üìÑ Gerador de Of√≠cios</h1>
            <p class="description">Cria√ß√£o autom√°tica de of√≠cios para requisi√ß√£o de dados cadastrais</p>
            <p class="credits">Criado por Gustavo Godoy Alevado e Fernando Gon√ßalves Ponce Corr√™a da Costa. Atualizado.</p>
        </div>

        <div class="form-group">
            <label class="form-label" for="tipoRequisicao">Tipo de Requisi√ß√£o:</label>
            <select id="tipoRequisicao" class="select-control">
                <option value="">Escolha um tipo de requisi√ß√£o...</option>
                <option value="delivery">Aplicativos de delivery</option>
                <option value="transporte">Aplicativos de transporte</option>
                <option value="aereas">Companhias a√©reas</option>
                <option value="rodovias">Concession√°rias de rodovias</option>
                <option value="govbr">Conta GOV.BR</option>
                <option value="cripto">Criptoativos</option>
                <option value="ecommerce">E-commerce</option>
                <option value="financeira">Institui√ß√µes Financeiras</option>
                <option value="locacao">Loca√ß√£o de ve√≠culo</option>
                <option value="telefonica">Operadoras Telef√¥nicas</option>
                <option value="internet">Provedores de Internet</option>
                <option value="servicos">Provedores de Servi√ßos</option>
                <option value="social">Redes Sociais - Dados Cadastrais e Preserva√ß√£o</option>
                <option value="meta_recovery">Redes Sociais - Recupera√ß√£o de Conta META</option>
                <option value="educacao">Secretaria de Educa√ß√£o</option>
                <option value="hospedagem">Servi√ßos de Hospedagem</option>
                <option value="onibus">Via√ß√µes de √¥nibus</option>
            </select>
        </div>

        <div id="configSection" class="config-section">
            <div class="form-group">
                <label class="form-label" for="tipoProcedimento">Tipo de Procedimento:</label>
                <select id="tipoProcedimento" class="select-control">
                    <option value="">Selecione o tipo...</option>
                    <option value="IP">IP</option>
                    <option value="AIP">AIP</option>
                    <option value="TCO">TCO</option>
                    <option value="ATP">ATP</option>
                    <option value="AI">AI</option>
                    <option value="BOC">BOC</option>
                    <option value="BO">BO</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label" for="numeroProcedimento">N√∫mero do procedimento:</label>
                <input type="text" id="numeroProcedimento" class="form-control" placeholder="Ex: 123/2025">
            </div>

            <div class="form-group" id="empresaContainer">
                <label class="form-label" for="empresa">Nome da Empresa/Institui√ß√£o:</label>
                <input type="text" id="empresa" class="form-control" placeholder="Digite o nome da empresa...">
                <div id="suggestionsContainer" class="suggestions-container"></div>
            </div>

            <div id="metaRecoveryFields" class="hidden">
                <div class="meta-fields-grid">
                    <div class="form-group">
                        <label class="form-label" for="plataforma">Plataforma:</label>
                        <select id="plataforma" class="select-control">
                            <option value="">Selecione...</option>
                            <option value="Facebook">Facebook</option>
                            <option value="Instagram">Instagram</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="nomeUsuarioOriginal">Nome do usu√°rio original:</label>
                        <input type="text" id="nomeUsuarioOriginal" class="form-control" placeholder="Nome do usu√°rio original">
                    </div>
                </div>

                <div class="meta-fields-grid">
                    <div class="form-group">
                        <label class="form-label" for="urlPerfil">URL/nome do perfil:</label>
                        <input type="text" id="urlPerfil" class="form-control" placeholder="URL ou nome do perfil">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="dataInvasao">Data aproximada da invas√£o (hackeamento):</label>
                        <input type="text" id="dataInvasao" class="form-control" placeholder="dd/mm/aaaa">
                    </div>
                </div>
                <div class="meta-fields-grid">
                    <div class="form-group">
                        <label class="form-label" for="idiomaOriginal">Idioma original do perfil:</label>
                        <input type="text" id="idiomaOriginal" class="form-control" placeholder="Ex: Portugu√™s (Brasil)">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="emailsAssociados">Email(s) associados:</label>
                        <input type="text" id="emailsAssociados" class="form-control" placeholder="email1@exemplo.com">
                    </div>
                </div>
                <div class="meta-fields-grid">
                    <div class="form-group">
                        <label class="form-label" for="telefonesAssociados">Telefone(s) (+55):</label>
                        <input type="text" id="telefonesAssociados" class="form-control" placeholder="+55 11 99999-9999">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="verificacaoDoisFatores">2FA ativado?</label>
                        <select id="verificacaoDoisFatores" class="select-control">
                            <option value="N√£o sabe informar">N√£o sabe informar</option>
                            <option value="Sim">Sim</option>
                            <option value="N√£o">N√£o</option>
                        </select>
                    </div>
                </div>
                 <div class="form-group">
                    <label class="form-label" for="emailSeguro">Email seguro:</label>
                    <input type="email" id="emailSeguro" class="form-control">
                </div>
                <div class="form-group">
                    <label class="form-label" for="atividadeCriminosa">Atividade criminosa:</label>
                    <textarea id="atividadeCriminosa" class="form-control" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label" for="confirmacaoAutoridade">Confirma√ß√£o Autoridade:</label>
                    <select id="confirmacaoAutoridade" class="select-control">
                         <option value="Sim, confirmo que estou realizando esta solicita√ß√£o em nome do usu√°rio/v√≠tima">Sim, confirmo</option>
                    </select>
                </div>
            </div>

            <div id="originalFields">
                <div class="form-group">
                    <label class="form-label" for="identificador">Identificador de Busca:</label>
                    <select id="identificador" class="select-control">
                        <option value="">Selecione...</option>
                    </select>
                </div>

                <div id="outrosContainer" class="form-group hidden">
                    <label class="form-label" for="identificadorCustomizado">Especifique o Identificador:</label>
                    <input type="text" id="identificadorCustomizado" class="form-control" placeholder="Ex: N√∫mero da conta, ID do usu√°rio">
                </div>

                <div id="ipContainer" class="form-group hidden">
                    <label class="form-label" for="listaIps">Lista de IPs (um por linha):</label>
                    <textarea id="listaIps" class="ip-textarea" placeholder="192.168.1.1, 01/01/2025, 14:30, UTC-3"></textarea>
                </div>

                <div id="valorContainer" class="form-group">
                    <label class="form-label" for="valor">Valor do Identificador:</label>
                    <input type="text" id="valor" class="form-control" placeholder="Digite o valor do identificador...">
                    <p class="help-text" id="mascaraHelp"></p>
                </div>

                <div id="periodoWrapper" class="form-group hidden">
                    <div id="checkboxPeriodoContainer" class="checkbox-container hidden">
                        <input type="checkbox" id="checkPeriodo">
                        <label for="checkPeriodo" style="color: #e2e8f0; font-weight: 600;">Incluir Per√≠odo de Busca</label>
                    </div>
                    
                    <div id="camposPeriodo">
                        <label class="form-label">Per√≠odo de Busca:</label>
                        <div class="period-group">
                            <div>
                                <label class="form-label" for="periodoInicio">In√≠cio:</label>
                                <input type="text" id="periodoInicio" class="form-control" placeholder="dd/mm/aaaa">
                            </div>
                            <div>
                                <label class="form-label" for="periodoFim">Fim:</label>
                                <input type="text" id="periodoFim" class="form-control" placeholder="dd/mm/aaaa">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="email-prazo-group">
                <div class="form-group">
                    <label class="form-label" for="email">E-mail para Resposta:</label>
                    <input type="email" id="email" class="form-control" placeholder="seu.email@pjc.mt.gov.br">
                </div>
                <div class="form-group" id="prazoContainer">
                    <label class="form-label" for="prazo">Prazo:</label>
                    <input type="text" id="prazo" class="form-control" placeholder="Ex: 10 dias">
                </div>
            </div>

            <div class="btn-group">
                <button id="btnGerar" class="btn">‚úÖ Gerar Of√≠cio</button>
                <button id="btnLimparConfig" class="btn btn-secondary">üóëÔ∏è Limpar Configura√ß√£o</button>
            </div>
        </div>

        <div class="resultado-section">
            <div class="form-group">
                <label class="form-label" for="nomeEmpresa">Nome da Empresa/Institui√ß√£o (Destino):</label>
                <input type="text" id="nomeEmpresa" class="form-control" readonly>
                <div class="btn-group" style="margin-top: 10px;">
                    <button id="btnCopiarEmpresa" class="btn btn-info">üìã Copiar Empresa</button>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" for="tituloOficio">Assunto do of√≠cio:</label>
                <input type="text" id="tituloOficio" class="form-control" readonly>
                <div class="btn-group" style="margin-top: 10px;">
                    <button id="btnCopiarTitulo" class="btn btn-info">üìã Copiar Assunto</button>
                </div>
            </div>
            
            <label class="form-label" for="resultadoTexto">Of√≠cio Gerado:</label>
            <textarea id="resultadoTexto" class="resultado-textarea" readonly></textarea>
            
            <div class="btn-group">
                <button id="btnCopiar" class="btn btn-info">üìã Copiar Texto</button>
                <button id="btnLimpar" class="btn btn-secondary">üóëÔ∏è Limpar Resultado</button>
            </div>
        </div>
    </div>

    <script>
        // --- Dados de Configura√ß√£o ---
        const empresasSugeridas = {
            'telefonica': ['VIVO S/A', 'CLARO S/A', 'TIM S/A', 'ALGAR TELECOM S/A', 'SURF TELECOM'],
            'internet': ['NET VIRTUA', 'VIVO FIBRA', 'NIO (VTAL)', 'TIM LIVE', 'CLARO NET', 'COPEL TELECOM'],
            'social': ['WhatsApp LLC', 'Meta Platforms Inc (Facebook e Instagram)', 'X CORP (Twitter)', 'GOOGLE Brasil Internet LTDA (YouTube)', 'TELEGRAM', 'TIKTOK'],
            'servicos': ['Apple Computer Brasil Ltda', 'Google Brasil Internet Ltda', 'MICROSOFT CORPORATION', 'UBER', '99'],
            'hospedagem': ['HOSTINGER', 'CLOUDFLARE', 'LOCAWEB', 'HOSTGATOR', 'TURBOCLOUD', 'KINGHOST', 'GODADDY', 'AWS', 'DIGITALOCEAN'],
            'financeira': ['BANCO DO BRASIL S/A', 'CAIXA ECON√îMICA FEDERAL', 'BANCO BRADESCO S/A', 'ITA√ö UNIBANCO S/A', 'SANTANDER', 'BANCO INTER', 'NUBANK', 'MERCADO PAGO', 'PIC PAY'],
            'cripto': ['BINANCE', 'MERCADO BITCOIN', 'OKX', 'BYBIT', 'KRAKEN', 'BITGET', 'FOXBIT', 'BITSO'],
            // Novos tipos
            'aereas': ['GOL LINHAS A√âREAS INTELIGENTES', 'LATAM AIRLINES BRASIL', 'AZUL LINHAS A√âREAS BRASILEIRAS'],
            'onibus': ['VIA√á√ÉO JU√çNA', 'VIA√á√ÉO OURO E PRATA', 'EXPRESSO GUANABARA', 'EXPRESSO ITAMARATI', 'VIA√á√ÉO ANDORINHA', 'EUCATUR', 'EXPRESSO S√ÉO LUIZ', 'RIO NOVO TRANSPORTES'],
            'rodovias': ['RODOVIA DA MUDAN√áA', 'INTERVIAS', 'APASI', 'SPS', 'MORRO DA MESA', 'VIA BRASIL', 'VIA NORTE SUL', 'ROTA DOS GR√ÉOS', 'NOVA ROTA DO OESTE'],
            'educacao': ['SECRETARIA ESTADUAL DE EDUCA√á√ÉO', 'SECRETARIA MUNICIPAL DE EDUCA√á√ÉO DE CUIAB√Å', 'SECRETARIA MUNICIPAL DE EDUCA√á√ÉO DE V√ÅRZEA GRANDE'],
            'ecommerce': ['AMAZON SERVI√áOS DE VAREJO DO BRASIL LTDA', 'MERCADO LIVRE', 'MAGAZINE LUIZA', 'CASAS BAHIA', 'NETSHOES', 'ALIEXPRESS', 'SHEIN', 'OLX'],
            'locacao': ['LOCALIZA RENT A CAR S/A', 'MOVIDA', 'UNIDAS'],
            'transporte': ['UBER BRASIL TELECNOLOGIA LTDA', '99 TECNOLOGIA LTDA', 'URBANO NORTE TECNOLOGIA LTDA'],
            'delivery': ['IFOOD.COM AG√äNCIA DE RESTAURANTES ONLINE S.A', 'Z√â SOLU√á√ïES TECNOL√ìGICAS DE COM√âRCIO DE BEBIDAS LTDA (Z√â DELIVERY)', '99 TECNOLOGIA LTDA']
        };

        const identificadores = {
            'telefonica': ['Telefone', 'CPF', 'CNPJ', 'IMEI', 'OUTROS'],
            'internet': ['CPF', 'CNPJ', 'IP', 'OUTROS'],
            'social': ['E-mail', 'Telefone', 'Username', 'UserID', 'URL do perfil', 'OUTROS'],
            'servicos': ['CPF', 'E-mail', 'Telefone', 'ID da conta/usu√°rio', 'OUTROS'],
            'hospedagem': ['CPF', 'CNPJ', 'E-mail', 'Dom√≠nio/URL', 'IP do servidor', 'ID da conta', 'OUTROS'],
            'financeira': ['CPF', 'CNPJ', 'PIX (chave)', 'Ag√™ncia e conta', 'N√∫mero do Cart√£o de cr√©dito/d√©bito', 'OUTROS'],
            'cripto': ['CPF', 'CNPJ', 'E-mail', 'Telefone', 'Endere√ßo de carteira (wallet)', 'Hash da transa√ß√£o', 'OUTROS'],
            // Novos tipos
            'aereas': ['CPF', 'CNPJ', 'Localizador', 'N√∫mero de recibo', 'N√∫mero de ordem', 'Outros'],
            'onibus': ['CPF', 'Nome do passageiro', 'Outros'],
            'rodovias': ['Placa(s) de ve√≠culo(s)', 'Outros'],
            'govbr': ['CPF'],
            'educacao': ['Nome do aluno', 'CPF do aluno', 'Nome da m√£e', 'E-mail', 'Outros'],
            'ecommerce': ['CPF', 'E-mail', 'N√∫mero de cart√£o de cr√©dito', 'N√∫mero de telefone', 'Outros'],
            'locacao': ['CPF', 'Placa do ve√≠culo', 'N√∫mero de cart√£o de cr√©dito', 'Outros'],
            'transporte': ['CPF do passageiro', 'E-mail', 'N√∫mero do telefone', 'CPF do motorista', 'Placa do ve√≠culo', 'N√∫mero de cart√£o de cr√©dito', 'Outros'],
            'delivery': ['CPF do cliente', 'E-mail do cliente', 'Telefone do cliente', 'Primeiros 6 d√≠gitos + √∫ltimos 4 d√≠gitos do cart√£o + data', 'CPF do entregador', 'E-mail do entregador', 'Telefone do entregador']
        };

        // Elementos DOM
        const tipoSelect = document.getElementById('tipoRequisicao');
        const configSection = document.getElementById('configSection');
        const empresaInput = document.getElementById('empresa');
        const suggestionsContainer = document.getElementById('suggestionsContainer');
        const identificadorSelect = document.getElementById('identificador');
        const outrosContainer = document.getElementById('outrosContainer');
        const ipContainer = document.getElementById('ipContainer');
        const valorContainer = document.getElementById('valorContainer');
        const valorInput = document.getElementById('valor');
        const periodoWrapper = document.getElementById('periodoWrapper');
        const checkboxPeriodoContainer = document.getElementById('checkboxPeriodoContainer');
        const checkPeriodo = document.getElementById('checkPeriodo');
        const camposPeriodo = document.getElementById('camposPeriodo');
        const metaRecoveryFields = document.getElementById('metaRecoveryFields');
        const originalFields = document.getElementById('originalFields');
        const mascaraHelp = document.getElementById('mascaraHelp');

        // --- Fun√ß√µes de M√°scara ---
        function aplicarMascara(valor, tipo) {
            valor = valor.replace(/\D/g, ""); // Remove n√£o d√≠gitos
            
            if (tipo === 'CPF') {
                valor = valor.replace(/(\d{3})(\d)/, "$1.$2");
                valor = valor.replace(/(\d{3})(\d)/, "$1.$2");
                valor = valor.replace(/(\d{3})(\d{1,2})$/, "$1-$2");
            } else if (tipo === 'CNPJ') {
                valor = valor.replace(/^(\d{2})(\d)/, "$1.$2");
                valor = valor.replace(/^(\d{2})\.(\d{3})(\d)/, "$1.$2.$3");
                valor = valor.replace(/\.(\d{3})(\d)/, ".$1/$2");
                valor = valor.replace(/(\d{4})(\d)/, "$1-$2");
            } else if (tipo === 'Telefone') {
                valor = valor.replace(/^(\d{2})(\d)/g, "($1) $2");
                valor = valor.replace(/(\d)(\d{4})$/, "$1-$2");
            } else if (tipo === 'IMEI') {
                if (valor.length > 15) valor = valor.substring(0, 15);
                // IMEI apenas n√∫meros, sem formata√ß√£o especial al√©m de limite
            } else if (tipo === 'Data') {
                 if (valor.length > 8) valor = valor.substring(0, 8);
                 if (valor.length > 2) valor = valor.replace(/^(\d{2})(\d)/, "$1/$2");
                 if (valor.length > 5) valor = valor.replace(/^(\d{2})\/(\d{2})(\d)/, "$1/$2/$3");
            }
            return valor;
        }

        valorInput.addEventListener('input', function(e) {
            const idSel = identificadorSelect.value;
            let tipoMascara = null;

            if (idSel.includes('CPF')) tipoMascara = 'CPF';
            else if (idSel.includes('CNPJ')) tipoMascara = 'CNPJ';
            else if (idSel.toLowerCase().includes('telefone')) tipoMascara = 'Telefone';
            else if (idSel === 'IMEI') tipoMascara = 'IMEI';

            if (tipoMascara) {
                e.target.value = aplicarMascara(e.target.value, tipoMascara);
            }
        });

        // Formata√ß√£o de datas
        ['periodoInicio', 'periodoFim', 'dataInvasao'].forEach(id => {
            const el = document.getElementById(id);
            if(el) {
                el.addEventListener('input', (e) => {
                    e.target.value = aplicarMascara(e.target.value, 'Data');
                });
            }
        });

        // --- L√≥gica Principal ---

        tipoSelect.addEventListener('change', onTipoSelected);
        identificadorSelect.addEventListener('change', onIdentificadorSelected);
        checkPeriodo.addEventListener('change', function() {
            if(this.checked) {
                camposPeriodo.classList.remove('hidden');
            } else {
                camposPeriodo.classList.add('hidden');
            }
        });

        document.getElementById('btnGerar').addEventListener('click', gerarOficio);
        document.getElementById('btnCopiar').addEventListener('click', () => copiar(document.getElementById('resultadoTexto')));
        document.getElementById('btnCopiarEmpresa').addEventListener('click', () => copiar(document.getElementById('nomeEmpresa')));
        document.getElementById('btnCopiarTitulo').addEventListener('click', () => copiar(document.getElementById('tituloOficio')));
        document.getElementById('btnLimpar').addEventListener('click', () => {
             document.getElementById('resultadoTexto').value = '';
             document.getElementById('nomeEmpresa').value = '';
             document.getElementById('tituloOficio').value = '';
        });
        document.getElementById('btnLimparConfig').addEventListener('click', limparConfig);

        function onTipoSelected() {
            const tipo = tipoSelect.value;
            configSection.classList.add('show');
            
            // Reset visual
            metaRecoveryFields.classList.add('hidden');
            originalFields.classList.remove('hidden');
            empresaInput.readOnly = false;
            empresaInput.value = '';
            periodoWrapper.classList.add('hidden');
            checkboxPeriodoContainer.classList.add('hidden');
            camposPeriodo.classList.remove('hidden'); // default state for non-checkbox types
            document.getElementById('empresaContainer').classList.remove('hidden');
            
            // Identificadores
            identificadorSelect.innerHTML = '<option value="">Selecione...</option>';
            if (identificadores[tipo]) {
                identificadores[tipo].forEach(id => {
                    const opt = document.createElement('option');
                    opt.value = id;
                    opt.textContent = id;
                    identificadorSelect.appendChild(opt);
                });
            }

            // L√≥gica Espec√≠fica por Tipo
            if (tipo === 'meta_recovery') {
                metaRecoveryFields.classList.remove('hidden');
                originalFields.classList.add('hidden');
                document.getElementById('empresaContainer').classList.add('hidden');
                empresaInput.value = 'META PLATFORMS, INC.';
            } 
            else if (tipo === 'govbr') {
                empresaInput.value = 'MINIST√âRIO DA GEST√ÉO E DA INOVA√á√ÉO EM SERVI√áOS P√öBLICOS';
                empresaInput.readOnly = true;
                identificadorSelect.value = 'CPF';
                identificadorSelect.dispatchEvent(new Event('change'));
                
                // Per√≠odo com Checkbox
                periodoWrapper.classList.remove('hidden');
                checkboxPeriodoContainer.classList.remove('hidden');
                camposPeriodo.classList.add('hidden'); // come√ßa escondido
                checkPeriodo.checked = false;
            }
            else {
                atualizarSugestoesEmpresas(tipo);
                
                // Configura√ß√£o de Per√≠odo
                if (['telefonica', 'social', 'servicos'].includes(tipo)) {
                    // Per√≠odo sempre vis√≠vel (padr√£o antigo)
                    periodoWrapper.classList.remove('hidden');
                    checkboxPeriodoContainer.classList.add('hidden');
                    camposPeriodo.classList.remove('hidden');
                } else if (['aereas', 'onibus', 'rodovias', 'govbr'].includes(tipo)) {
                    // Per√≠odo Opcional (Checkbox)
                    periodoWrapper.classList.remove('hidden');
                    checkboxPeriodoContainer.classList.remove('hidden');
                    camposPeriodo.classList.add('hidden'); // come√ßa escondido
                    checkPeriodo.checked = false;
                }
            }
        }

        function onIdentificadorSelected() {
            const id = identificadorSelect.value;
            outrosContainer.classList.add('hidden');
            ipContainer.classList.add('hidden');
            valorContainer.classList.remove('hidden');
            mascaraHelp.textContent = '';

            if (id === 'OUTROS' || id === 'Outros') {
                outrosContainer.classList.remove('hidden');
            } else if (id === 'IP' || id === 'IP de acesso') {
                ipContainer.classList.remove('hidden');
                valorContainer.classList.add('hidden');
            }

            // Dicas de M√°scara
            if (id.includes('CPF')) mascaraHelp.textContent = 'Formato: XXX.XXX.XXX-XX';
            else if (id.includes('CNPJ')) mascaraHelp.textContent = 'Formato: XX.XXX.XXX/XXXX-XX';
            else if (id.toLowerCase().includes('telefone')) mascaraHelp.textContent = 'Formato: (XX) XXXXX-XXXX';
            else if (id === 'IMEI') mascaraHelp.textContent = 'Apenas n√∫meros (15 d√≠gitos)';
        }

        function atualizarSugestoesEmpresas(tipo) {
            suggestionsContainer.innerHTML = '';
            if (empresasSugeridas[tipo]) {
                const label = document.createElement('p');
                label.className = 'form-label';
                label.textContent = 'Sugest√µes:';
                suggestionsContainer.appendChild(label);
                
                const grid = document.createElement('div');
                grid.className = 'suggestions-grid';
                
                empresasSugeridas[tipo].forEach(emp => {
                    const btn = document.createElement('button');
                    btn.className = 'suggestion-btn';
                    btn.textContent = emp;
                    btn.type = 'button';
                    btn.addEventListener('click', () => empresaInput.value = emp);
                    grid.appendChild(btn);
                });
                suggestionsContainer.appendChild(grid);
            }
        }

        function gerarOficio() {
            const tipo = tipoSelect.value;
            const procTipo = document.getElementById('tipoProcedimento').value;
            const procNum = document.getElementById('numeroProcedimento').value;
            const email = document.getElementById('email').value;
            const prazo = document.getElementById('prazo').value;
            
            if (!procTipo || !procNum || !email) {
                alert('Preencha os campos obrigat√≥rios (Procedimento, N√∫mero e E-mail).');
                return;
            }

            let texto = '';
            let assunto = '';
            let empresaDestino = '';

            // --- L√≥gica META RECOVERY ---
            if (tipo === 'meta_recovery') {
                const plataforma = document.getElementById('plataforma').value;
                const userOrig = document.getElementById('nomeUsuarioOriginal').value;
                const url = document.getElementById('urlPerfil').value;
                const dataInv = document.getElementById('dataInvasao').value;
                const idioma = document.getElementById('idiomaOriginal').value;
                const emails = document.getElementById('emailsAssociados').value;
                const tels = document.getElementById('telefonesAssociados').value;
                const mfa = document.getElementById('verificacaoDoisFatores').value;
                const emailSeguro = document.getElementById('emailSeguro').value;
                const atividade = document.getElementById('atividadeCriminosa').value;
                const confirmacao = document.getElementById('confirmacaoAutoridade').value;

                texto = `Senhor Diretor,\n\nVisando instruir o ${procTipo} n¬∫ ${procNum}, na qualidade de Delegado(a) de Pol√≠cia Civil, no exerc√≠cio das atribui√ß√µes que me conferem os arts. 144, ¬ß 4¬∫, da CF c/c art. 2¬∫, ¬ß2¬∫, da Lei 12.830/2013, requisito a recupera√ß√£o da conta abaixo identificada, conforme dados a seguir:\n\n1. Plataforma: ${plataforma}\n2. Nome do usu√°rio original: ${userOrig}\n3. URL/nome do perfil: ${url}\n4. Data aproximada da invas√£o (hackeamento): ${dataInv}\n5. Idioma original do perfil: ${idioma}\n6. Email(s) associados com o perfil antes da invas√£o: ${emails}\n7. Telefone(s) ‚Äì com c√≥digo de pa√≠s ‚Äì associados com o perfil antes da invas√£o: ${tels}\n8. Confirma√ß√£o se a verifica√ß√£o de dois fatores estava ativada: ${mfa}\n9. Email seguro do usu√°rio (n√£o pode estar ou ter sido associado, em momento algum, a nenhuma conta do Facebook/Instagram): ${emailSeguro}\n10. Atividade criminosa em pr√°tica pela conta (por parte do invasor): ${atividade}\n11. Confirma√ß√£o de que a autoridade solicitante est√° realizando a solicita√ß√£o de recupera√ß√£o em nome do usu√°rio/v√≠tima: ${confirmacao}\n\nA investiga√ß√£o policial √© sigilosa (art. 20 CPP) e, por isso, o usu√°rio n√£o deve ser notificado acerca das requisi√ß√µes policiais.\n\nPor fim, solicito que a resposta seja encaminhada para o e-mail ${email}.\n\nAtenciosamente,`;
                assunto = `SOLICITA√á√ÉO DE RECUPERA√á√ÉO DE CONTA META - ${procTipo} n¬∫ ${procNum}`;
                empresaDestino = 'META PLATFORMS, INC.';
            
            } else {
                // --- L√≥gica PADR√ÉO ---
                empresaDestino = empresaInput.value;
                if (!empresaDestino && tipo !== 'govbr') return alert('Informe o nome da empresa.');
                
                const idSel = identificadorSelect.value;
                let idValor = valorInput.value;
                let idLabel = idSel;
                
                if (idSel === 'OUTROS' || idSel === 'Outros') {
                    idLabel = document.getElementById('identificadorCustomizado').value;
                } else if (idSel === 'IP' || idSel === 'IP de acesso') {
                    idValor = document.getElementById('listaIps').value;
                }

                // L√≥gica de Datas
                const dataIni = document.getElementById('periodoInicio').value;
                const dataFim = document.getElementById('periodoFim').value;
                const usaPeriodoCheckbox = ['aereas', 'onibus', 'rodovias', 'govbr'].includes(tipo);
                const periodoAtivo = usaPeriodoCheckbox ? checkPeriodo.checked : (dataIni && dataFim);
                
                let textoPeriodo = "";
                if (periodoAtivo && dataIni && dataFim) {
                    textoPeriodo = `, no per√≠odo de ${dataIni} a ${dataFim}`;
                }

                // Header Padr√£o
                const header = `Senhor Diretor,\n\nVisando instruir o ${procTipo} n¬∫ ${procNum}, na qualidade de Delegado(a) de Pol√≠cia Civil, no exerc√≠cio das atribui√ß√µes que me conferem os art. 144, ¬ß 4¬∫, da CF c/c art. 2¬∫, ¬ß2¬∫, da Lei 12.830/2013, e com fundamento nos arts. 10, ¬ß3¬∫ e 15, da Lei 12.965/2014 c/c art. 17-B da Lei 9.613/98 e art. 15 da Lei 12.850/2013`;
                const footer = `\n\nA investiga√ß√£o policial √© sigilosa (art. 20 CPP) e, por isso, o usu√°rio n√£o deve ser notificado acerca das requisi√ß√µes policiais.\n\nPor fim, solicito que a resposta seja encaminhada para o e-mail ${email}.\n\nAtenciosamente,`;
                const preservacao = `\n\nAdicionalmente, requisito, com base no art. 15, ¬ß 1¬∫, da Lei n¬∫ 12.965/2014, a preserva√ß√£o de dados e de todos os registros de conex√£o e de acesso a aplica√ß√µes de internet relacionados ao(s) identificador(es) acima mencionado(s), pelo per√≠odo de 1 (um) ano, a partir da data desta comunica√ß√£o, a fim de viabilizar futura ordem judicial para acesso ao seu conte√∫do.`;

                // Constru√ß√£o por TIPO
                if (tipo === 'rodovias') {
                    texto = `${header}, venho requisitar no prazo de ${prazo} o fornecimento de relat√≥rio acerca de todas as passagens dos ve√≠culos de placas ${idValor}${textoPeriodo}, assim como os registros fotogr√°ficos das suas passagens.${footer}`;
                
                } else if (tipo === 'govbr') {
                    texto = `${header}, venho requisitar no prazo de ${prazo} o fornecimento dos dados cadastrais das seguintes contas GOV.BR de bem como dos dados de status, endere√ßo IP de origem, porta l√≥gica, e-mail, telefone, dados do dispositivo, al√©m da descri√ß√£o de todos os eventos, do CPF n¬∫ ${idValor}${textoPeriodo}.${preservacao}${footer}`;
                
                } else if (tipo === 'educacao') {
                    texto = `${header}, venho requisitar no prazo de ${prazo} o fornecimento de todos os dados cadastrais, notadamente endere√ßo residencial, telefone para contato, nome e telefone do respons√°vel, referentes ao identificador: ${idLabel} ${idValor}.${footer}`;
                
                } else if (tipo === 'ecommerce') {
                    texto = `${header}, venho requisitar no prazo de ${prazo} o fornecimento de todos os dados cadastrais dispon√≠veis, bem como informe todas as compras j√° realizadas, descriminando os valores, datas, produtos, endere√ßo de entrega e nome/telefone do destinat√°rio, respons√°vel pelo recebimento, e forma de pagamento, referentes ao identificador: ${idLabel} ${idValor}.${footer}`;
                
                } else if (tipo === 'locacao') {
                    texto = `${header}, venho requisitar no prazo de ${prazo} o fornecimento de todos os dados cadastrais dispon√≠veis, notadamente nome, CPF, endere√ßo, telefone, e-mail, forma de pagamento, al√©m de informa√ß√µes sobre outras loca√ß√µes realizadas pelo contratante nos √∫ltimos 12 meses, assim como c√≥pia dos respectivos contratos de loca√ß√£o de ve√≠culos, referentes ao identificador: ${idLabel} ${idValor}.${footer}`;
                
                } else if (tipo === 'transporte') {
                    texto = `${header}, venho requisitar no prazo de ${prazo} o fornecimento de todos os dados cadastrais dispon√≠veis, notadamente nome, CPF, endere√ßo, telefone, e-mail, forma de pagamento, referentes ao identificador: ${idLabel} ${idValor}.${footer}`;
                
                } else if (tipo === 'delivery') {
                    texto = `${header}, venho requisitar no prazo de ${prazo} o fornecimento de todos os dados cadastrais dispon√≠veis, notadamente nome, e-mail, terminal telef√¥nico, CPF e endere√ßos cadastrados, referentes ao identificador: ${idLabel} ${idValor}.${footer}`;
                
                } else if (tipo === 'aereas' || tipo === 'onibus') {
                    // Texto gen√©rico + per√≠odo espec√≠fico
                    texto = `${header}, venho requisitar os dados cadastrais e de viagens vinculados ao identificador: ${idLabel}: ${idValor}${textoPeriodo}, no prazo de ${prazo}.${footer}`;
                
                } else if (tipo === 'telefonica') {
                    if (idSel === 'Telefone') {
                        texto = `${header}, requisito os dados cadastrais vinculados ao terminal telef√¥nico: ${idValor}${textoPeriodo}, bem como os respectivos IMEIs habilitados, no prazo de ${prazo}.`;
                    } else if (idSel === 'CPF') {
                        texto = `${header}, requisito os dados cadastrais vinculados ao CPF ${idValor}${textoPeriodo}, terminais telef√¥nicos cadastrados no CPF e IMEIs habilitados, no prazo de ${prazo}.`;
                    } else if (idSel === 'IMEI') {
                        texto = `${header}, requisito informa√ß√µes referentes aos terminais telef√¥nicos vinculados ao IMEI ${idValor}, bem como os dados cadastrais do titular${textoPeriodo}, no prazo de ${prazo}.`;
                    } else {
                        texto = `${header}, requisito os dados cadastrais vinculados ao identificador de busca: ${idLabel}: ${idValor}${textoPeriodo}, no prazo de ${prazo}.`;
                    }
                    texto += footer;
                
                } else if (tipo === 'internet' || tipo === 'social' || tipo === 'servicos') {
                    // Padr√£o com preserva√ß√£o
                    texto = `${header}, venho requisitar os dados cadastrais vinculados ao identificador: ${idLabel}: ${idValor}${textoPeriodo}, no prazo de ${prazo}.${preservacao}${footer}`;
                
                } else if (tipo === 'hospedagem') {
                     texto = `${header}, venho requisitar os dados cadastrais vinculados ao identificador: ${idLabel}: ${idValor}, em especial nome completo, filia√ß√£o, telefone, endere√ßo, estado civil, profiss√£o, e-mail, e-mail de recupera√ß√£o, data de nascimento, n√∫mero de telefone celular e IMEI, ID DEVICE, fotos enviadas no ato da abertura da conta/cadastro e outros dispon√≠veis, bem como informar os produtos contratados, no prazo de ${prazo}.${preservacao}${footer}`;

                } else if (tipo === 'financeira') {
                    texto = `${header}, venho requisitar os dados cadastrais vinculados ao identificador: ${idLabel}: ${idValor}, no prazo de ${prazo}.\n\nA resposta dever√° conter os seguintes dados: documentos de identifica√ß√£o, filia√ß√£o, dados de contato (telefone e e-mail) informados, data de abertura e endere√ßo do titular; selfie (foto do pr√≥prio rosto) e c√≥pia (digitalizada) dos documentos apresentados; dados do dispositivo (Protocolo de Internet - IP, atributos do dispositivo e dados de geolocaliza√ß√£o) utilizados na cria√ß√£o da conta.${preservacao}${footer}`;
                
                } else if (tipo === 'cripto') {
                     texto = `${header}, venho requisitar os dados cadastrais vinculados ao identificador: ${idLabel}: ${idValor}, no prazo de ${prazo}.\n\nOs dados cadastrais devem contemplar o nome completo, filia√ß√£o, endere√ßo, estado civil, profiss√£o, e-mail, e-mail de recupera√ß√£o, data de nascimento, foto selfie eventualmente enviada, documentos completo do KYC (conhe√ßa seu cliente), n√∫mero de telefone celular fornecido no ato da abertura da conta/cadastro e outros dados dispon√≠veis.${preservacao}${footer}`;
                }

                assunto = `REQUISI√á√ÉO DE INFORMA√á√ïES - ${procTipo} n¬∫ ${procNum}`;
            }

            document.getElementById('resultadoTexto').value = texto;
            document.getElementById('tituloOficio').value = assunto;
            document.getElementById('nomeEmpresa').value = empresaDestino;
        }

        function copiar(element) {
            if (!element.value) return alert('Nada para copiar.');
            element.select();
            document.execCommand('copy');
            alert('Copiado para a √°rea de transfer√™ncia!');
        }

        function limparConfig() {
            tipoSelect.value = '';
            document.getElementById('numeroProcedimento').value = '';
            document.getElementById('empresa').value = '';
            identificadorSelect.innerHTML = '<option value="">Selecione...</option>';
            valorInput.value = '';
            document.getElementById('prazo').value = '';
            configSection.classList.remove('show');
            checkPeriodo.checked = false;
        }
    </script>
</body>
</html>
